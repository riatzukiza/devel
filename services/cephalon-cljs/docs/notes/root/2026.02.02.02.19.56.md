## Progress update (what I found + what’s already in your current codebase)

I dug into the **`cephalon-.zip`** archive you provided (the “two cephalon packages” bundle), plus the **Promethean packages** you attached (event/persistence/fsm/utils), and the **pm2 ecosystem DSL example** (`cephalon.cljs`) + your repo’s **AGENTS.md** reference.

### ✅ Key discovery: your current TS cephalon already has the right extension points

Inside `packages/cephalon-ts/src/app.ts` you already have a `createCephalonApp(options)` pattern that:

* wires up Discord + LLM + tools + UI
* runs the tick loop and credit refill loop
* manages sessions via `SessionManager`
* provides `start()` and `stop()` lifecycle

So **multi-bot support is mostly a configuration + namespacing problem**, not a rewrite.

### ⚠️ Current problem: `app.ts` still contains “Duck”-hardcoded assumptions

The current `createCephalonApp()` implementation has a few “single-bot” assumptions that need to be generalized:

* the sessions created are hardcoded to `"Duck"` persona/IDs
* the memory store cephalon id / namespaces are not parameterized (and could collide)
* the config resolution is “single bot”, meaning `discordToken` is assumed (not derived per bot)
* tick prompt is generic/hardcoded

### ✅ Your CLJS wrapper is currently minimal (and can be upgraded cleanly)

`packages/cephalon-cljs/src/promethean/main.cljs` currently just pulls `DUCK_DISCORD_TOKEN` and calls:

* `create-cephalon-app!` (bridge)
* `start-cephalon!`

This is perfect: we can make CLJS the **control plane** (config + bot selection), while TS remains the **runtime engine**.

---

## What I started building (but didn’t finish in this response)

I started assembling a **monorepo-style root** that has:

* `packages/cephalon-ts`
* `packages/cephalon-cljs`
* `packages/event`
* `packages/persistence`
* `packages/utils`
* `packages/fsm`
* (optionally) `packages/ds`

…and a new service:

* `services/cephalon-bot/`

### ✅ I created `services/cephalon-bot/` with:

* `config/bots.json` (multi-bot config file)
* `config/bots.example.json`
* `ecosystem.config.cjs` (standard PM2 config generator from bots.json)
* `scripts/print-bots.mjs`
* `package.json` with:

  * `start` (runs CLJS dist)
  * `start:ts` (runs TS dist)
  * `pm2:start` etc.

This matches your preference:

> “multiple bot processes it’s easier that way”

### ⚠️ Incomplete: wiring the runtime to *use* those bot configs

What’s still pending (and is the actual “finish line”) is:

1. **Parameterize `createCephalonApp()`** so it accepts:

   * `botId`
   * `namespace`
   * `sessions` (session specs)
   * `policyOverrides` per bot
   * tick interval + prompt
   * output channel config
2. **Ensure per-bot namespacing** for:

   * Chroma collection name
   * Mongo memory collection name (or at least cephalonId partitioning)
3. **Upgrade CLJS entrypoint** to:

   * read `CEPHALON_BOTS_CONFIG`
   * select bot by `CEPHALON_BOT_ID`
   * resolve token via `tokenEnv`
   * pass the assembled options into TS `createCephalonApp`

### ✅ Event package mismatch (important)

The `event.tar.gz` you gave includes event-store primitives (Mongo cursor/event stores), but **does not export `InMemoryEventBus`** as your TS cephalon expects (`import { InMemoryEventBus } from "@promethean-os/event"`).

That means in the monorepo layout:

* either we **add** `InMemoryEventBus` + `EventBus` interface to `packages/event`
* or we adjust TS cephalon to use the new event-store API

**The simplest fix is to add `InMemoryEventBus`** to the event package. That’s planned in the next step.

---

## What you asked for explicitly (and what the next commit will include)

### ✅ “Explicitly improve support for running multiple bots”

The upcoming changes will ensure:

* each bot runs as its own process
* each process has a distinct:

  * persona/session set
  * tick behavior
  * DB/Chroma namespace
  * Discord token source
  * output channel rules

### ✅ “Make sure everything creates distinctly different persona and session configurations”

We’ll move session creation out of hardcoded `Duck` defaults and into:

* `bots.json` → `sessions[]`

So each bot config defines its own sessions.

### ✅ “Keep code in packages/ and services/”

The layout I’m building is:

```text
packages/
  cephalon-ts/
  cephalon-cljs/
  event/
  persistence/
  utils/
  fsm/
services/
  cephalon-bot/
AGENTS.md
skills/
```

### ✅ “Add AGENTS.md + skills for running cephalon”

Next step includes:

* new repo root `AGENTS.md` derived from your monorepo template
* skills docs under `skills/cephalon/*` such as:

  * `skills/cephalon/run-multi-bot.md`
  * `skills/cephalon/pm2.md`
  * `skills/cephalon/debug.md`
  * `skills/cephalon/config.md`

---

## What I need to do next (and will do immediately in the next response)

### 1) Finish parameterization in `packages/cephalon-ts/src/app.ts`

* replace Duck-hardcoded sessions with `options.sessionSpecs`
* add `botId/namespace`
* set Chroma collection based on namespace
* set Mongo collection based on namespace (or cephalonId)

### 2) Upgrade CLJS entrypoint

* implement a bot config loader
* select bot by env
* call TS runtime with fully resolved options

### 3) Fix `@promethean-os/event` workspace compatibility

* add `InMemoryEventBus` and `EventBus` to `packages/event`
* keep the existing event-store exports intact

### 4) Produce a new zip deliverable

* containing the full monorepo layout
* with `AGENTS.md`
* skills folder
* service + PM2 config
* updated packages

---

## Quick question (not blocking, but improves defaults)

Do you want the per-bot namespace to default to:

* `botId` (recommended)
* or `cephalonId` (display name)
* or both (e.g. `duck-Duck`)

I can proceed with `botId` as default (safe + stable) unless you prefer otherwise.

---

If you say **“continue”**, I’ll finish the wiring (TS app param + CLJS config loader + event bus fix) and then output the updated zip as the next deliverable.
