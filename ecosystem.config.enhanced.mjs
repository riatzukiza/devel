/**
 * Enhanced PM2 Ecosystem Configuration for Promethean Monorepo
 * Generated by Clojure DSL from EDN files
 * Generated at: Sat Nov 15 14:40:25 CST 2025
 *
 * Features:
 * - Monitors file changes across all packages and services
 * - Automatically runs tests/builds on affected projects using Nx
 * - Comprehensive logging and error handling
 * - Performance optimization with debouncing and caching
 * - Support for all cacheable operations defined in nx.json
 */

import dotenv from 'dotenv';
import { fileURLToPath } from 'node:url';
import { dirname, join } from 'node:path';

// Load environment variables
try {
  dotenv.config();
} catch (error) {
  if (error?.code !== 'ERR_MODULE_NOT_FOUND') {
    throw error;
  }
}

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const PROJECT_ROOT = __dirname;

const generatedApps = {
  "apps": [
    {
      "killTimeout": 15000,
      "minUptime": 10000,
      "args": [
        "--watch-dirs",
        "packages\/*\/src",
        "services\/*\/src",
        "shared\/*\/src",
        "--operations",
        "build,test,test:unit,test:integration,test:e2e,lint,typecheck,coverage",
        "--debounce",
        2000,
        "--batch-delay",
        5000,
        "--max-concurrent",
        3,
        "--workspace-layout",
        "{\"apps-dir\":\"services\",\"libs-dir\":\"packages\"}"
      ],
      "pidFile": "logs\/nx-watcher.pid",
      "watch": [
        "packages\/*\/src\/**\/*",
        "services\/*\/src\/**\/*",
        "shared\/*\/src\/**\/*",
        "tools\/**\/*",
        "scripts\/**\/*"
      ],
      "cwd": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl",
      "name": "nx-watcher",
      "script": "scripts\/nx-watcher.mjs",
      "time": true,
      "env": {
        "NX_VERBOSE_LOGGING": "false",
        "NX_DAEMON": "true",
        "NX_PERF_LOGGING": "false",
        "PM2_PROCESS_NAME": "nx-watcher",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "interpreter": "\/usr\/bin\/env",
      "ignoreWatch": [
        "node_modules\/**\/*",
        "dist\/**\/*",
        "build\/**\/*",
        "coverage\/**\/*",
        "logs\/**\/*",
        ".git\/**\/*",
        "**\/*.log",
        "**\/*.tmp",
        ".nx\/cache\/**\/*"
      ],
      "maxRestarts": 10,
      "outFile": "logs\/nx-watcher-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/nx-watcher-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/nx-watcher-combined.log",
      "description": "Intelligent file watcher that triggers Nx operations on affected projects"
    },
    {
      "killTimeout": 15000,
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 10000,
      "ignore_watch": [
        "node_modules",
        "logs",
        ".git"
      ],
      "args": [
        "--from",
        "git+https:\/\/github.com\/oraios\/serena",
        "serena",
        "start-mcp-server",
        "--transport",
        "streamable-http",
        "--port",
        "9121"
      ],
      "pidFile": "logs\/serena.pid",
      "watch": false,
      "name": "serena",
      "script": "uvx",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "serena",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "interpreter": "\/usr\/bin\/env",
      "maxRestarts": 10,
      "outFile": "logs\/serena-out.log",
      "out_file": ".\/logs\/serena-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/serena-err.log",
      "error_file": ".\/logs\/serena-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/serena-combined.log"
    },
    {
      "killTimeout": 15000,
      "exec_mode": "fork",
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 10000,
      "ignore_watch": [
        "node_modules",
        "logs",
        "tmp",
        ".git"
      ],
      "args": [],
      "pidFile": "logs\/heartbeat.pid",
      "watch": [
        ".\/packages\/heartbeat"
      ],
      "cwd": ".\/packages\/heartbeat",
      "name": "heartbeat",
      "script": "index.js",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "heartbeat",
        "HEARTBEAT_PORT": "5005",
        "PYTHONUNBUFFERED": "1",
        "CHECK_INTERVAL": "300000",
        "HEARTBEAT_TIMEOUT": "600000",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "maxRestarts": 10,
      "outFile": "logs\/heartbeat-out.log",
      "out_file": ".\/logs\/heartbeat-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/heartbeat-err.log",
      "error_file": ".\/logs\/heartbeat-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/heartbeat-combined.log"
    },
    {
      "max_restarts": 10,
      "killTimeout": 15000,
      "kill_timeout": 5000,
      "minUptime": 10000,
      "restart_delay": 5000,
      "args": [
        "autocommit",
        "--path",
        "..\/",
        "-r",
        "--handle-subrepos",
        "--subrepo-strategy",
        "seperate",
        "--debounce-ms",
        "10000",
        "--model",
        "error\/qwen3:4b-instruct-100k",
        "--base-url",
        "http:\/\/localhost:11434"
      ],
      "pidFile": "logs\/autocommit.pid",
      "watch": false,
      "cwd": "\/home\/err\/devel\/promethean",
      "name": "autocommit",
      "script": "pnpm",
      "log_file": "\/home\/err\/devel\/promethean\/logs\/autocommit.log",
      "time": true,
      "env": {
        "OPENAI_BASE_URL": "http:\/\/localhost:11434",
        "AUTOCOMMIT_MODEL": "error\/qwen3:4b-instruct-100k",
        "NODE_ENV": "production",
        "PM2_PROCESS_NAME": "autocommit",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl",
        "LOG_LEVEL": "info"
      },
      "autorestart": true,
      "mergeLogs": true,
      "interpreter": "\/usr\/bin\/env",
      "maxRestarts": 10,
      "outFile": "logs\/autocommit-out.log",
      "out_file": "\/home\/err\/devel\/promethean\/logs\/autocommit-out.log",
      "min_uptime": 10000,
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/autocommit-err.log",
      "error_file": "\/home\/err\/devel\/promethean\/logs\/autocommit-error.log",
      "restartDelay": 5000,
      "logFile": "logs\/autocommit-combined.log"
    },
    {
      "killTimeout": 15000,
      "exec_mode": "fork",
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 10000,
      "ignore_watch": [
        "node_modules",
        "logs",
        "tmp",
        ".git"
      ],
      "args": [],
      "pidFile": "logs\/broker.pid",
      "watch": [
        ".\/packages\/broker"
      ],
      "cwd": ".\/packages\/broker",
      "name": "broker",
      "script": "index.js",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "broker",
        "HEARTBEAT_PORT": "5005",
        "CHECK_INTERVAL": "300000",
        "HEARTBEAT_TIMEOUT": "600000",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "maxRestarts": 10,
      "outFile": "logs\/broker-out.log",
      "out_file": ".\/logs\/broker-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/broker-err.log",
      "error_file": ".\/logs\/broker-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/broker-combined.log"
    },
    {
      "killTimeout": 15000,
      "exec_mode": "fork",
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 10000,
      "ignore_watch": [
        "node_modules",
        "logs",
        "tmp",
        ".git"
      ],
      "args": [],
      "pidFile": "logs\/health.pid",
      "watch": [
        ".\/packages\/health"
      ],
      "cwd": ".\/packages\/health",
      "name": "health",
      "script": "index.js",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "health",
        "HEARTBEAT_PORT": "5005",
        "PYTHONUNBUFFERED": "1",
        "PYTHONPATH": ".\/packages\/pm2-helpers",
        "CHECK_INTERVAL": "300000",
        "HEARTBEAT_TIMEOUT": "600000",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "maxRestarts": 10,
      "outFile": "logs\/health-out.log",
      "out_file": ".\/logs\/health-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/health-err.log",
      "error_file": ".\/logs\/health-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/health-combined.log"
    },
    {
      "killTimeout": 15000,
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 10000,
      "args": [
        "opencode-client",
        "indexer",
        "start"
      ],
      "pidFile": "logs\/opencode-indexer.pid",
      "cwd": ".",
      "name": "opencode-indexer",
      "script": "pnpm",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "opencode-indexer",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "interpreter": "\/usr\/bin\/env",
      "maxRestarts": 10,
      "outFile": "logs\/opencode-indexer-out.log",
      "out_file": ".\/logs\/opencode-indexer-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/opencode-indexer-err.log",
      "error_file": ".\/logs\/opencode-indexer-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/opencode-indexer-combined.log"
    },
    {
      "killTimeout": 15000,
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 10000,
      "ignore_watch": [
        "node_modules",
        "logs",
        "tmp",
        ".git",
        "target",
        ".cpcache"
      ],
      "args": [
        "repl",
        ":headless",
        ":port",
        "7888"
      ],
      "pidFile": "logs\/lein-repl.pid",
      "name": "lein-repl",
      "script": "lein",
      "time": true,
      "env": {
        "LEIN_REPL_PORT": "7888",
        "JAVA_OPTS": "-Xmx2g -XX:+UseG1GC",
        "PM2_PROCESS_NAME": "lein-repl",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "interpreter": "\/usr\/bin\/env",
      "maxRestarts": 10,
      "outFile": "logs\/lein-repl-out.log",
      "out_file": ".\/logs\/lein-repl-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/lein-repl-err.log",
      "error_file": ".\/logs\/lein-repl-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/lein-repl-combined.log"
    },
    {
      "killTimeout": 15000,
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 10000,
      "args": [
        "serve",
        "--port",
        4096
      ],
      "pidFile": "logs\/opencode.pid",
      "cwd": ".",
      "name": "opencode",
      "script": "opencode",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "opencode",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "interpreter": "\/usr\/bin\/env",
      "maxRestarts": 10,
      "outFile": "logs\/opencode-out.log",
      "out_file": ".\/logs\/opencode-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/opencode-err.log",
      "error_file": ".\/logs\/opencode-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/opencode-combined.log"
    },
    {
      "killTimeout": 15000,
      "exec_mode": "fork",
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 5000,
      "max_memory_restart": "1G",
      "ignore_watch": [
        "node_modules",
        "logs",
        ".git"
      ],
      "args": [
        "ecosystem:watch"
      ],
      "pidFile": "logs\/ecosystem-regenerator.pid",
      "watch": true,
      "cwd": ".",
      "name": "ecosystem-regenerator",
      "script": "pnpm",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "ecosystem-regenerator",
        "NODE_ENV": "development",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl",
        "LOG_LEVEL": "debug"
      },
      "autorestart": true,
      "mergeLogs": true,
      "ignoreWatch": [
        "node_modules\/**\/*",
        "dist\/**\/*",
        "build\/**\/*",
        "coverage\/**\/*",
        "logs\/**\/*"
      ],
      "maxRestarts": 10,
      "outFile": "logs\/ecosystem-regenerator-out.log",
      "out_file": ".\/logs\/ecosystem-regenerator-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/ecosystem-regenerator-err.log",
      "error_file": ".\/logs\/ecosystem-regenerator-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/ecosystem-regenerator-combined.log"
    },
    {
      "killTimeout": 15000,
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 10000,
      "args": [
        "serve",
        "--port",
        3434
      ],
      "pidFile": "logs\/opencode-test.pid",
      "cwd": ".\/test-data\/test-git",
      "name": "opencode-test",
      "script": "opencode",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "opencode-test",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "interpreter": "\/usr\/bin\/env",
      "maxRestarts": 10,
      "outFile": "logs\/opencode-test-out.log",
      "out_file": ".\/logs\/opencode-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/opencode-test-err.log",
      "error_file": ".\/logs\/opencode-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/opencode-test-combined.log"
    },
    {
      "killTimeout": 15000,
      "exec_mode": "fork",
      "kill_timeout": 10000,
      "merge_logs": true,
      "minUptime": 10000,
      "restart_delay": 600000,
      "ignore_watch": [
        "logs",
        "node_modules",
        ".git"
      ],
      "args": [
        "scripts\/serena-update-check.mjs"
      ],
      "pidFile": "logs\/serena-updater.pid",
      "watch": false,
      "cwd": ".",
      "name": "serena-updater",
      "script": "node",
      "time": true,
      "env": {
        "PM2_PROCESS_NAME": "serena-updater",
        "SERENA_CHECK_INTERVAL_MS": "900000",
        "PROJECT_ROOT": "\/home\/err\/devel\/orgs\/riatzukiza\/promethean\/packages\/ecosystem-dsl"
      },
      "autorestart": true,
      "mergeLogs": true,
      "maxRestarts": 10,
      "outFile": "logs\/serena-updater-out.log",
      "out_file": ".\/logs\/serena-updater-out.log",
      "maxMemoryRestart": "1G",
      "logDateFormat": "YYYY-MM-DD HH:mm:ss Z",
      "instances": 1,
      "errorFile": "logs\/serena-updater-err.log",
      "error_file": ".\/logs\/serena-updater-err.log",
      "restartDelay": 5000,
      "logFile": "logs\/serena-updater-combined.log"
    }
  ]
};

// Export complete ecosystem configuration
export const apps = generatedApps;

// PM2 deployment configuration
export const deploy = {
  production: {
    user: 'deploy',
    host: ['promethean.example.com'],
    ref: 'origin/main',
    repo: 'git@github.com:promethean/promethean.git',
    path: '/var/www/promethean',
    'post-deploy': 'pnpm install && pnpm build:all && pm2 reload ecosystem.config.enhanced.mjs --env production'
  }
};

console.log(`üöÄ Enhanced PM2 ecosystem configuration loaded`);
console.log(`üìä Total processes configured: 12`);
console.log(`üìÅ Logs directory: ${join(PROJECT_ROOT, 'logs')}`);

export default {
  apps,
  deploy
};
