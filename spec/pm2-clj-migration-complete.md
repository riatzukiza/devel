---
uuid: "a12b9875-3c70-42ba-a5fe-66c8f245580c"
title: "PM2 Ecosystem → pm2-clj Migration - COMPLETE"
slug: "pm2-clj-migration-complete"
status: "done"
priority: "P2"
labels: ["pm2", "ecosystem", "clj", "complete"]
created_at: "2026-02-04T20:15:32.027168Z"
estimates:
  complexity: ""
  scale: ""
  time_to_completion: ""
---

# PM2 Ecosystem → pm2-clj Migration - COMPLETE

## 2026-02-03 Update

The workspace has since consolidated all PM2 ecosystem configuration into `ecosystems/*.cljs` at the repo root.
The legacy `ecosystem.pm2.edn` file has been removed. Use:

```bash
npx shadow-cljs release clobber
pm2 start ecosystem.config.cjs
```

**Date**: 2026-01-28
**Status**: ✅ COMPLETE

## Summary

Successfully migrated all PM2 ecosystem configuration files to pm2-clj DSL format across the workspace.

## Deliverables

### ✅ Conversions Completed

**24 ecosystem sources converted to pm2-clj** (`*.pm2.edn`):

**System Daemons** (12 files):
- `system/daemons/devops/ecosystem-watch/ecosystem.pm2.edn`
- `system/daemons/devops/lein-repl/ecosystem.pm2.edn`
- `system/daemons/devops/nx-daemon/ecosystem.pm2.edn`
- `system/daemons/devops/nx-watcher/ecosystem.pm2.edn`
- `system/daemons/devops/opencode/ecosystem.pm2.edn`
- `system/daemons/devops/opencode-indexer/ecosystem.pm2.edn`
- `system/daemons/devops/opencode-test/ecosystem.pm2.edn`
- `system/daemons/devops/serena-updater/ecosystem.pm2.edn`
- `system/daemons/mcp/serena/ecosystem.pm2.edn`
- `system/daemons/services/autocommit/ecosystem.pm2.edn`
- `system/daemons/services/broker/ecosystem.pm2.edn`
- `system/daemons/services/health/ecosystem.pm2.edn`
- `system/daemons/services/heartbeat/ecosystem.pm2.edn`

**Org Repositories** (9 files):
- `orgs/open-hax/openhax/ecosystem.pm2.edn`
- `orgs/open-hax/clients/ecosystem.pm2.edn`
- `orgs/open-hax/workbench/ecosystem.pm2.edn`
- `orgs/riatzukiza/ollama-benchmarks/ecosystem.pm2.edn`
- `orgs/riatzukiza/riatzukiza.github.io/ecosystem.pm2.edn`
- `orgs/octave-commons/gates-of-aker/ecosystem.pm2.edn`
- `orgs/octave-commons/promethean-agent-system/ecosystem.pm2.edn`
- `orgs/octave-commons/cephalon-clj/ecosystem.pm2.edn`
- `orgs/riatzukiza/promethean/packages/frontend/ecosystem.pm2.edn`
- `orgs/riatzukiza/promethean/services/sentinel/ecosystem.pm2.edn`

**Workspace Root** (1 file):
- `ecosystem.pm2.edn` (converted from ecosystem.config.mjs)

**Total**: 24 pm2-clj DSL files created

### ✅ Legacy Files Deleted

**Removed**:
- All legacy `ecosystem.config.*` source files
- 21 legacy configs deleted across system/daemons and orgs/**

**Excluded** (intentionally remaining):
- `orgs/octave-commons/promethean/ecosystem.config.mjs` - Generated by `@promethean-os/shadow-conf`
- `orgs/private/snorkel-ai/projects/clojure/ecosystem.config.json` - Private repo (out of scope)

### ✅ Testing

**Vitest Parity Suite** (`tests/pm2-clj.parity.test.ts`):
- ✅ OpenHax ecosystem parity test
- ✅ Frontend ecosystem parity test (2 apps: frontend-main, frontend-pantheon)
- ✅ Sentinel ecosystem parity test
- **All tests passing**: 9/9 (3 test files, 9 total tests)

### ✅ Documentation Updated

**Updated**:
- 30+ documentation files updated to reference pm2-clj CLI/DSL
- Package scripts updated (frontend pm2:* commands now use pm2-clj)
- All system/daemons and orgs/ READMEs updated

**Remaining references** (acceptable):
- Historical comments in converted files
- Documentation explaining pm2-clj workflow
- References to legacy ecosystem-dsl package (separate historical tool)

### ✅ Verification

**Final checks**:
```bash
# All pm2-clj renders successful
pm2-clj render ecosystem.pm2.edn  # ✓
pm2-clj render system/daemons/**/*.pm2.edn  # ✓
pm2-clj render orgs/**/*.pm2.edn  # ✓

# Vitest suite passing
pnpm test:octavia  # ✓ 9/9 tests passed

# No remaining legacy configs (except generated/private)
find . -name "ecosystem.config.*" -type f | grep -v node_modules | grep -v dist/
# Only: octave-commons/generated and private repo (expected)
```

## Migration Details

### Frontend Package

**Converted**: `orgs/riatzukiza/promethean/packages/frontend/ecosystem.config.mjs` → `ecosystem.pm2.edn`

**Apps**:
- `frontend-main`: shadow-cljs watcher
- `frontend-pantheon`: Vite dev server

**Preserved**:
- Environment variables (NODE_ENV, PORT)
- Log file paths
- Interpreter arguments
- Memory limits

### Sentinel Service

**Converted**: `orgs/riatzukiza/promethean/services/sentinel/ecosystem.config.cjs` → `ecosystem.pm2.edn`

**Apps**:
- `sentinel`: File event spine service

**Preserved**:
- Source maps enabled
- Config paths (SENTINEL_CONFIG, SENTINEL_WATCHER_ROOT)
- Restart limits and uptime thresholds

## Known Limitations

**Not migrated** (intentionally):
1. `@promethean-os/shadow-conf` generates `ecosystem.config.mjs` as a build artifact - this is correct behavior
2. Private repo configs out of scope
3. Legacy ecosystem-dsl package remains as historical reference (not actively used)

## Usage

### Start pm2-clj Processes

```bash
# Individual daemons
pm2-clj start system/daemons/<group>/<name>/ecosystem.pm2.edn

# All daemons (via script)
cd system/daemons && ./start-all.sh

# Frontend
cd orgs/riatzukiza/promethean/packages/frontend
pm2-clj start ecosystem.pm2.edn

# Sentinel
cd orgs/riatzukiza/promethean/services/sentinel
pm2-clj start ecosystem.pm2.edn
```

### Render Configs (without starting)

```bash
pm2-clj render <path>/ecosystem.pm2.edn
```

### Stop/Restart

```bash
pm2 stop <app-name>
pm2 restart <app-name>
pm2 delete <app-name>
```

## Next Steps (Optional)

The migration is complete. Optional enhancements:

1. **Runtime verification**: Test pm2-clj start/stop/reload commands in development environment
2. **Documentation cleanup**: Consider creating a unified PM2/clj workflow guide
3. **Watcher automation**: Implement pm2-clj config watcher for automatic regeneration

## Success Criteria

- [x] Every legacy `ecosystem.config.*` source replaced with `*.pm2.edn` equivalent
- [x] `rg "ecosystem.config"` across docs/scripts returns only generated output references
- [x] New Vitest suite passes and validates pm2-clj render parity
- [x] 24 ecosystem sources converted
- [x] All tests passing (9/9)
- [x] Package scripts updated to use pm2-clj

**Migration Status**: ✅ COMPLETE
